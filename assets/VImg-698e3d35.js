import{p as B,ac as q,B as F,T as H,ae as W,l as L,s as _,r as U,c as y,x as z,S as A,U as D,F as O,K as G,m as s,L as K,d as J,G as Q}from"./index-90280fdc.js";import{f as X,m as Y,u as Z,V as k}from"./color-73a8f508.js";const p=B({transition:{type:[Boolean,String,Object],default:"fade-transition",validator:e=>e!==!0}},"transition"),b=(e,o)=>{let{slots:u}=o;const{transition:r,disabled:d,...l}=e,{component:a=H,...c}=typeof r=="object"?r:{};return q(a,F(typeof r=="string"?{name:d?"":r}:c,l,{disabled:d}),u)};function ee(e,o){if(!W)return;const u=o.modifiers||{},r=o.value,{handler:d,options:l}=typeof r=="object"?r:{handler:r,options:{}},a=new IntersectionObserver(function(){var f;let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],g=arguments.length>1?arguments[1]:void 0;const n=(f=e._observe)==null?void 0:f[o.instance.$.uid];if(!n)return;const v=c.some(S=>S.isIntersecting);d&&(!u.quiet||n.init)&&(!u.once||v||n.init)&&d(v,c,g),v&&u.once?$(e,o):n.init=!0},l);e._observe=Object(e._observe),e._observe[o.instance.$.uid]={init:!1,observer:a},a.observe(e)}function $(e,o){var r;const u=(r=e._observe)==null?void 0:r[o.instance.$.uid];u&&(u.observer.unobserve(e),delete e._observe[o.instance.$.uid])}const te={mounted:ee,unmounted:$},re=te,ae=B({alt:String,cover:Boolean,eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},srcset:String,...X(),...Y(),...p()},"VImg"),le=L()({name:"VImg",directives:{intersect:re},props:ae(),emits:{loadstart:e=>!0,load:e=>!0,error:e=>!0},setup(e,o){let{emit:u,slots:r}=o;const d=_(""),l=U(),a=_(e.eager?"loading":"idle"),c=_(),g=_(),n=y(()=>e.src&&typeof e.src=="object"?{src:e.src.src,srcset:e.srcset||e.src.srcset,lazySrc:e.lazySrc||e.src.lazySrc,aspect:Number(e.aspectRatio||e.src.aspect||0)}:{src:e.src,srcset:e.srcset,lazySrc:e.lazySrc,aspect:Number(e.aspectRatio||0)}),v=y(()=>n.value.aspect||c.value/g.value||0);z(()=>e.src,()=>{f(a.value!=="idle")}),z(v,(t,i)=>{!t&&i&&l.value&&h(l.value)}),A(()=>f());function f(t){if(!(e.eager&&t)&&!(W&&!t&&!e.eager)){if(a.value="loading",n.value.lazySrc){const i=new Image;i.src=n.value.lazySrc,h(i,null)}n.value.src&&D(()=>{var i,m;if(u("loadstart",((i=l.value)==null?void 0:i.currentSrc)||n.value.src),(m=l.value)!=null&&m.complete){if(l.value.naturalWidth||I(),a.value==="error")return;v.value||h(l.value,null),S()}else v.value||h(l.value),w()})}}function S(){var t;w(),a.value="loaded",u("load",((t=l.value)==null?void 0:t.currentSrc)||n.value.src)}function I(){var t;a.value="error",u("error",((t=l.value)==null?void 0:t.currentSrc)||n.value.src)}function w(){const t=l.value;t&&(d.value=t.currentSrc||t.src)}let T=-1;function h(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const m=()=>{clearTimeout(T);const{naturalHeight:V,naturalWidth:j}=t;V||j?(c.value=j,g.value=V):!t.complete&&a.value==="loading"&&i!=null?T=window.setTimeout(m,i):(t.currentSrc.endsWith(".svg")||t.currentSrc.startsWith("data:image/svg+xml"))&&(c.value=1,g.value=1)};m()}const P=y(()=>({"v-img__img--cover":e.cover,"v-img__img--contain":!e.cover})),N=()=>{var m;if(!n.value.src||a.value==="idle")return null;const t=s("img",{class:["v-img__img",P.value],src:n.value.src,srcset:n.value.srcset,alt:e.alt,sizes:e.sizes,ref:l,onLoad:S,onError:I},null),i=(m=r.sources)==null?void 0:m.call(r);return s(b,{transition:e.transition,appear:!0},{default:()=>[O(i?s("picture",{class:"v-img__picture"},[i,t]):t,[[Q,a.value==="loaded"]])]})},x=()=>s(b,{transition:e.transition},{default:()=>[n.value.lazySrc&&a.value!=="loaded"&&s("img",{class:["v-img__img","v-img__img--preload",P.value],src:n.value.lazySrc,alt:e.alt},null)]}),C=()=>r.placeholder?s(b,{transition:e.transition,appear:!0},{default:()=>[(a.value==="loading"||a.value==="error"&&!r.error)&&s("div",{class:"v-img__placeholder"},[r.placeholder()])]}):null,E=()=>r.error?s(b,{transition:e.transition,appear:!0},{default:()=>[a.value==="error"&&s("div",{class:"v-img__error"},[r.error()])]}):null,M=()=>e.gradient?s("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${e.gradient})`}},null):null,R=_(!1);{const t=z(v,i=>{i&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{R.value=!0})}),t())})}return Z(()=>{const[t]=k.filterProps(e);return O(s(k,F({class:["v-img",{"v-img--booting":!R.value},e.class],style:[{width:J(e.width==="auto"?c.value:e.width)},e.style]},t,{aspectRatio:v.value,"aria-label":e.alt,role:e.alt?"img":void 0}),{additional:()=>s(K,null,[s(N,null,null),s(x,null,null),s(M,null,null),s(C,null,null),s(E,null,null)]),default:r.default}),[[G("intersect"),{handler:f,options:e.options},null,{once:!0}]])}),{currentSrc:d,image:l,state:a,naturalWidth:c,naturalHeight:g}}});export{b as M,le as V};
